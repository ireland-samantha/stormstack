# Thunder Control Plane Configuration
quarkus.application.name=thunder-control-plane

# HTTP configuration - runs on 8081 to avoid conflict with engine nodes
quarkus.http.port=8081

# CORS - configure allowed origins for production security
# SECURITY: Do NOT use wildcard (*) in production - set CORS_ALLOWED_ORIGINS env var
quarkus.http.cors=true
quarkus.http.cors.origins=${CORS_ALLOWED_ORIGINS:http://localhost:5173,http://localhost:8080,http://localhost:8082}
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization,X-Control-Plane-Token,X-Api-Token

# Logging
quarkus.log.level=INFO
quarkus.log.category."ca.samanthaireland.stormstack.thunder".level=DEBUG

# Jackson configuration
quarkus.jackson.fail-on-unknown-properties=false

# Redis configuration
quarkus.redis.hosts=${REDIS_HOSTS:redis://localhost:6379}

# Control Plane configuration
control-plane.node-ttl-seconds=${NODE_TTL_SECONDS:30}
control-plane.auth-token=${CONTROL_PLANE_TOKEN:}
control-plane.require-auth=${CONTROL_PLANE_REQUIRE_AUTH:true}

# JWT Authentication (for admin dashboard endpoints)
# SECURITY: Enabled by default - set JWT_AUTH_ENABLED=false only for development
control-plane.jwt.enabled=${JWT_AUTH_ENABLED:true}
# URL of thunder-auth service for remote token validation
# Defaults to localhost:8082 for local development
control-plane.jwt.auth-service-url=${AUTH_SERVICE_URL:http://localhost:8082}
control-plane.jwt.connect-timeout-ms=${JWT_CONNECT_TIMEOUT:5000}
control-plane.jwt.request-timeout-ms=${JWT_REQUEST_TIMEOUT:10000}
control-plane.jwt.admin-roles=${JWT_ADMIN_ROLES:admin}
control-plane.jwt.view-roles=${JWT_VIEW_ROLES:admin,view_only}

# OAuth2 Client Credentials for service-to-service auth with thunder-auth
control-plane.jwt.oauth2-client-id=${OAUTH2_CLIENT_ID:control-plane}
control-plane.jwt.oauth2-client-secret=${OAUTH2_CLIENT_SECRET:}
control-plane.jwt.oauth2-scopes=${OAUTH2_SCOPES:service.match-token.issue service.match-token.validate engine.*}
control-plane.jwt.oauth2-token-refresh-buffer-seconds=${OAUTH2_TOKEN_REFRESH_BUFFER:60}

# SmallRye JWT configuration
# We use remote validation via AUTH_SERVICE_URL, so disable local JWT validation
quarkus.smallrye-jwt.enabled=false

# Autoscaler configuration
autoscaler.enabled=${AUTOSCALER_ENABLED:true}
autoscaler.scale-up-threshold=${AUTOSCALER_SCALE_UP_THRESHOLD:0.8}
autoscaler.scale-down-threshold=${AUTOSCALER_SCALE_DOWN_THRESHOLD:0.3}
autoscaler.min-nodes=${AUTOSCALER_MIN_NODES:1}
autoscaler.max-nodes=${AUTOSCALER_MAX_NODES:100}
autoscaler.cooldown-seconds=${AUTOSCALER_COOLDOWN_SECONDS:300}
autoscaler.target-saturation=${AUTOSCALER_TARGET_SATURATION:0.6}

# Metrics configuration
quarkus.micrometer.export.prometheus.enabled=true

# Module storage configuration
module-storage.directory=${MODULE_STORAGE_DIR:./modules}
module-storage.max-file-size=${MODULE_MAX_FILE_SIZE:104857600}

# Multipart file upload
quarkus.http.body.handle-file-uploads=true
quarkus.http.limits.max-body-size=110M

# Node proxy configuration
# Allows external clients (like Thunder CLI) to reach nodes through the control plane
control-plane.proxy.enabled=${PROXY_ENABLED:true}
control-plane.proxy.timeout-seconds=${PROXY_TIMEOUT_SECONDS:30}
control-plane.proxy.max-request-body-bytes=${PROXY_MAX_REQUEST_BODY_BYTES:10485760}
