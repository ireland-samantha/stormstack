# Lightning Auth Service Configuration
quarkus.application.name=lightning-auth

# HTTP configuration - runs on 8082 to avoid conflict with engine (8080) and control-plane (8081)
quarkus.http.port=8082

# CORS - allow frontend access
quarkus.http.cors=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization

# Logging
quarkus.log.level=INFO
quarkus.log.category."ca.samanthaireland.lightning".level=DEBUG

# Jackson configuration
quarkus.jackson.fail-on-unknown-properties=false

# MongoDB configuration
quarkus.mongodb.connection-string=${MONGODB_URI:mongodb://localhost:27017}
quarkus.mongodb.database=lightning-auth

# JWT Configuration
# We use our own JWT handling with auth0-jwt, so disable SmallRye JWT security
# The SmallRye JWT build extension is only used for token building if needed
quarkus.smallrye-jwt.enabled=false

# Auth Service Configuration
auth.jwt-issuer=${JWT_ISSUER:https://lightningfirefly.com}
# RSA key configuration for JWT signing (RS256) - preferred for production
auth.private-key-location=${JWT_PRIVATE_KEY_LOCATION:classpath:privateKey.pem}
auth.public-key-location=${JWT_PUBLIC_KEY_LOCATION:classpath:publicKey.pem}
# HMAC secret (HS256) - only used if RSA keys are not configured
auth.jwt-secret=${JWT_SECRET:}
auth.session-expiry-hours=${SESSION_EXPIRY_HOURS:24}
auth.bcrypt-cost=${BCRYPT_COST:12}
auth.initial-admin-password=${ADMIN_INITIAL_PASSWORD:}
auth.api-token-length-bytes=${API_TOKEN_LENGTH:32}

# Metrics configuration
quarkus.micrometer.export.prometheus.enabled=true

# Health check configuration
quarkus.smallrye-health.root-path=/q/health

# =========================================================================
# OAuth2 Configuration
# =========================================================================

# Token lifetimes (in seconds)
auth.oauth2.service-token-lifetime-seconds=${OAUTH2_SERVICE_TOKEN_LIFETIME:900}
auth.oauth2.user-token-lifetime-seconds=${OAUTH2_USER_TOKEN_LIFETIME:3600}
auth.oauth2.refresh-token-lifetime-seconds=${OAUTH2_REFRESH_TOKEN_LIFETIME:604800}

# Service Clients
# Control Plane - service-to-service authentication for issuing match tokens
auth.oauth2.clients[0].client-id=control-plane
auth.oauth2.clients[0].client-secret=${OAUTH2_CONTROL_PLANE_SECRET:control-plane-secret}
auth.oauth2.clients[0].client-type=confidential
auth.oauth2.clients[0].display-name=Lightning Control Plane
auth.oauth2.clients[0].allowed-scopes=service.match-token.issue,service.match-token.validate,service.match-token.revoke,service.token.read
auth.oauth2.clients[0].allowed-grant-types=client_credentials
auth.oauth2.clients[0].enabled=true

# Game Server - service-to-service authentication for validating match tokens
auth.oauth2.clients[1].client-id=game-server
auth.oauth2.clients[1].client-secret=${OAUTH2_GAME_SERVER_SECRET:game-server-secret}
auth.oauth2.clients[1].client-type=confidential
auth.oauth2.clients[1].display-name=Lightning Game Server
auth.oauth2.clients[1].allowed-scopes=service.match-token.validate,service.token.read
auth.oauth2.clients[1].allowed-grant-types=client_credentials
auth.oauth2.clients[1].enabled=true

# Admin CLI - public client for interactive authentication (no client secret required)
auth.oauth2.clients[2].client-id=admin-cli
auth.oauth2.clients[2].client-secret=not-used-for-public-client
auth.oauth2.clients[2].client-type=public
auth.oauth2.clients[2].display-name=Admin CLI
auth.oauth2.clients[2].allowed-scopes=*
auth.oauth2.clients[2].allowed-grant-types=password,refresh_token
auth.oauth2.clients[2].enabled=true

# Thunder CLI - public client for CLI tools (no client secret required)
auth.oauth2.clients[3].client-id=thunder-cli
auth.oauth2.clients[3].client-secret=not-used-for-public-client
auth.oauth2.clients[3].client-type=public
auth.oauth2.clients[3].display-name=Thunder CLI
auth.oauth2.clients[3].allowed-scopes=*
auth.oauth2.clients[3].allowed-grant-types=password,refresh_token,token_exchange
auth.oauth2.clients[3].enabled=true
